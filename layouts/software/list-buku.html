{{ define "main" }}
{{/* 
  SECTION: Persiapan Data
  Tujuan: Mengambil semua halaman reguler dari section "software" dan mengurutkannya
  secara descending berdasarkan tanggal, kemudian membuat paginator untuk membagi
  hasil menjadi beberapa halaman
*/}}
{{ $allPages := where site.RegularPages "Section" "software" }}
{{ $pages := $allPages.ByDate.Reverse }}
{{ $paginator := .Paginate $pages }}

  {{/* 
    SECTION: Kontainer Utama
    Tujuan: Membungkus seluruh konten halaman dengan padding dan margin yang sesuai
    untuk tampilan desktop dan mobile
  */}}
  <div class="container my-16 mx-auto px-4">
  {{/* 
    SECTION: Header Halaman
    Tujuan: Menampilkan judul dan deskripsi halaman untuk memberikan konteks
    kepada pengguna tentang konten yang akan ditampilkan
    PERUBAHAN: Menggunakan variabel dari halaman section (.Title dan .Description)
  */}}
  <div class="font-bold uppercase text-teal-600 dark:text-teal-400 text-sm mb-2">
    {{ if eq .Section "software" }}
      {{ if .CurrentSection.Parent }}
        {{ .CurrentSection.Parent.Title }}
      {{ else }}
        Semua Software
      {{ end }}
    {{ else }}
      {{ .Section | humanize }}
    {{ end }}
  </div>

  <h2 class="text-3xl text-slate-500 dark:text-slate-300 font-bold tracking-tight mb-2">
    {{ .Title }}
  </h2>

  <p class="text-lg mb-8 text-slate-500 dark:text-slate-300">
    {{ .Description | default "Temukan konten yang Anda butuhkan." }}
  </p>
  
  {{/* 
    SECTION: Grid Konten
    Tujuan: Membuat tata letak grid responsif yang menampilkan kartu software
    dan kartu permintaan software baru
  */}}
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {{/* 
      SUBSECTION: Loop Item Software
      Tujuan: Iterasi melalui setiap halaman software yang dipaginasi dan
      menampilkan informasi dalam format kartu yang konsisten
    */}}
    {{ range $paginator.Pages }}
      <div class="shadow-md p-4 rounded-lg text-slate-500 dark:text-slate-300 bg-white dark:bg-slate-800 hover:shadow-lg grid grid-cols-4 gap-4 h-full">
        {{/* 
          AREA: Gambar Cover Software
          Tujuan: Menampilkan gambar cover software dengan fallback ke placeholder
          jika gambar tidak tersedia, diklik akan mengarah ke halaman detail software
        */}}
        <div class="col-span-1">
          <a href="{{ .RelPermalink }}">
            <picture class="block">
              {{ if .Params.cover }}
              <img class="object-cover w-full h-40 dark:brightness-75 rounded-md" 
                   src="{{ .Params.cover | absURL }}" 
                   alt="Cover {{ .Title }}">
              {{ else }}
              <img class="object-cover w-full h-40 bg-gray-200 dark:brightness-75 rounded-md" 
                   src="/images/content/buku/placeholder-book.svg" 
                   alt="Placeholder Cover">
              {{ end }}
            </picture>
          </a>
        </div>
        
        {{/* 
          AREA: Informasi Teks Software
          Tujuan: Menampilkan metadata software (format, judul, penulis) dan
          deskripsi singkat dengan pembatasan jumlah baris
        */}}
        <div class="col-span-3 flex flex-col justify-between">
          <div>
            <h2 class="font-bold uppercase text-teal-600 dark:text-teal-400 text-xs">
              {{ .Params.format | default "Software" }}
            </h2>
            <h3 class="text-lg font-bold mb-1 tracking-tight line-clamp-1">
              <a href="{{ .RelPermalink }}" class="hover:text-teal-700 dark:hover:text-teal-300 transition-colors">
                {{ .Title }}
              </a>
            </h3>
            <p class="text-sm mb-2 text-slate-500 dark:text-slate-300 line-clamp-1">
              By {{ .Params.penulis | default .Params.author | default "Anonimous" }}
            </p>
          </div>
          <p class="text-xs text-slate-500 dark:text-slate-300 line-clamp-3">
            {{ .Description | default .Summary | truncate 120 }}
          </p>
        </div>
      </div>
    {{ end }}

    {{/* 
      SUBSECTION: Kartu Permintaan Software Baru
      Tujuan: Memberikan opsi bagi pengguna untuk meminta software yang belum
      tersedia di koleksi, dengan tautan ke formulir permintaan eksternal
    */}}
    <div class="p-4 active:scale-95 text-slate-400 dark:text-slate-600 rounded-lg border-2 border-dashed border-slate-300 hover:bg-teal-400/5 hover:border-teal-400 dark:hover:border-teal-400 dark:border-slate-700 grid grid-cols-4 gap-4 h-full">
      <div class="col-span-1">
        <a href="https://s.id/XpGDC" target="_blank" rel="noopener">
          <picture class="block">
            <img class="object-cover w-full h-40 dark:brightness-75 rounded-md" 
                 src="/images/content/buku/request-book.svg" 
                 alt="Request Buku">
          </picture>
        </a>
      </div>
      <div class="col-span-3 flex flex-col justify-between">
        <h3 class="text-lg font-bold mb-1 tracking-tight line-clamp-1">
          <a href="https://s.id/XpGDC" 
             target="_blank" 
             rel="noopener" 
             class="hover:text-teal-700 dark:hover:text-teal-300 transition-colors" 
             title="Request buku baru">
            Request Software Baru
          </a>
        </h3>
        <p class="text-sm line-clamp-3">
          Tidak menemukan Software yang kamu cari? Request software baru di sini.
        </p>
      </div>
    </div>
  </div>

  {{/* 
    SECTION: Pagination
    Tujuan: Menampilkan navigasi halaman jika jumlah total halaman lebih dari satu,
    memungkinkan pengguna untuk menelusuri seluruh koleksi software
  */}}
  {{ if gt $paginator.TotalPages 1 }}
  <div class="flex justify-center mt-12">
    <ul class="flex flex-row justify-center gap-2 md:gap-4">
      {{ partial "components/pagination.html" . }}
    </ul>
  </div>
  {{ end }}
</div>
{{ end }}