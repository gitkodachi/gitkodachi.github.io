<!-- layouts/shortcodes/image.html -->
<figure class="my-4 text-center">
  <img 
    src="{{ .Get "src" | absURL }}" 
    alt="{{ .Get "alt" | default "Image" }}" 
    class="mx-auto cursor-zoom-in max-w-full rounded"
    onclick="zoom(this)"
  >
  {{ with .Get "caption" }}
  <figcaption class="text-sm text-gray-500 mt-2">
    {{ . | markdownify }}
  </figcaption>
  {{ end }}
</figure>

<script>
function zoom(img) {
  const isZoomed = img.classList.toggle('zoomed');
  
  if (isZoomed) {
    // Calculate scale to fit screen
    const scale = Math.min(
      window.innerWidth * 0.9 / img.naturalWidth,
      window.innerHeight * 0.9 / img.naturalHeight,
      1.0 // Max 100% scale
    );
    
    img.style.setProperty('--zoom-scale', scale);
    document.body.style.overflow = 'hidden';
    
    // ESC key to exit
    const handleKey = (e) => e.key === 'Escape' && zoom(img);
    document.addEventListener('keydown', handleKey);
    img.dataset.escHandler = handleKey;
  } else {
    document.body.style.overflow = '';
    document.removeEventListener('keydown', img.dataset.escHandler);
  }
}
</script>

<style>
img.zoomed {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(var(--zoom-scale, 0.9));
  max-width: 90vw;
  max-height: 90vh;
  z-index: 1000;
  cursor: zoom-out;
  background: white;
  padding: 1rem;
  box-shadow: 0 0 0 100vmax rgba(0,0,0,0.8);
  object-fit: contain;
}

/* Prevents scrolling when zoomed */
body.overflow-hidden {
  overflow: hidden !important;
}
</style>