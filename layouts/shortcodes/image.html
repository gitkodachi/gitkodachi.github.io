<!-- layouts/shortcodes/image.html -->
<figure class="my-4 text-center">
  <img 
    src="{{ .Get "src" | absURL }}" 
    alt="{{ .Get "alt" | default "Image" }}" 
    class="cursor-zoom-in max-w-full rounded"
    onclick="zoom(this)"
  >
  {{ with .Get "caption" }}
  <figcaption class="text-sm text-gray-500 mt-2">
    {{ . | markdownify }}
  </figcaption>
  {{ end }}
</figure>

<script>
function zoom(img) {
  img.classList.toggle('zoomed');
  document.body.style.overflow = img.classList.contains('zoomed') ? 'hidden' : '';
  
  // ESC key to exit
  if (img.classList.contains('zoomed')) {
    const handleKey = (e) => e.key === 'Escape' && zoom(img);
    document.addEventListener('keydown', handleKey);
    img.onzoomout = () => document.removeEventListener('keydown', handleKey);
  } else if (img.onzoomout) {
    img.onzoomout();
  }
}
</script>

<style>
img.zoomed {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  max-height: 90vh;
  z-index: 100;
  cursor: zoom-out;
  box-shadow: 0 0 0 100vmax rgba(0,0,0,0.7);
}
</style>